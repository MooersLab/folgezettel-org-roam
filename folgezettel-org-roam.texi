\input texinfo    @c -*- texinfo -*-
@c %**start of header
@setfilename folgezettel-org-roam.info
@settitle Folgezettel Org-Roam Manual
@documentencoding UTF-8
@documentlanguage en
@c %**end of header

@copying
This manual is for Folgezettel Org-Roam (version 2.3.0).

Copyright @copyright{} 2025 Blaine Mooers.

@quotation
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
@end quotation
@end copying

@dircategory Emacs
@direntry
* Folgezettel Org-Roam: (folgezettel-org-roam). Automatic folgezettel linking for org-roam.
@end direntry

@titlepage
@title Folgezettel Org-Roam Manual
@subtitle Automatic Folgezettel Backlink Generation for Org-Roam
@subtitle Version 2.3.0
@author Blaine Mooers
@page
@vskip 0pt plus 1filll
@insertcopying
@end titlepage

@contents

@ifnottex
@node Top
@top Folgezettel Org-Roam

This manual describes Folgezettel Org-Roam, an Emacs package that provides
automatic bidirectional link generation for org-roam notes using folgezettel
(Luhmann-style) indexing.

@insertcopying
@end ifnottex

@menu
* Introduction::                What is Folgezettel Org-Roam?
* Installation::                How to install the package.
* Quick Start::                 Get started quickly.
* Folgezettel Addresses::       Understanding the addressing system.
* Usage::                       How to use the package.
* Customization::               Configuring the package.
* Commands::                    Interactive commands reference.
* Testing::                     Running the test suite.
* Troubleshooting::             Common issues and solutions.
* Index::                       Concept and function index.
@end menu

@c ============================================================================
@node Introduction
@chapter Introduction

@cindex folgezettel
@cindex Zettelkasten
@cindex Luhmann

Folgezettel Org-Roam is an Emacs package that brings Niklas Luhmann's
folgezettel (follow-up slip) system to org-roam.  The package automatically
manages bidirectional links between parent and child notes based on their
folgezettel addresses.

@section What is a Folgezettel?

A folgezettel is a sequential numbering system used in the Zettelkasten
(slip-box) method.  Each note has an address that encodes its position in
a hierarchy of ideas.  For example:

@itemize @bullet
@item
@code{1} - A root note (first topic)
@item
@code{1.2} - Second subtopic of note 1
@item
@code{1.2a} - First branch from 1.2
@item
@code{1.2a3} - Third continuation of 1.2a
@end itemize

@section Features

@itemize @bullet
@item
Automatic parent backlink generation when creating child notes
@item
Automatic forward link insertion in parent notes
@item
Bidirectional cross-linking when manually inserting links
@item
Validation to prevent invalid addresses
@item
Duplicate index detection
@item
Suggestions for next child address
@item
Database synchronization for immediate link visibility
@end itemize

@c ============================================================================
@node Installation
@chapter Installation

@section Requirements

@itemize @bullet
@item
Emacs 27.1 or later
@item
org-roam 2.0 or later
@end itemize

@section From MELPA

@findex package-install
Once the package is available on MELPA:

@example
M-x package-install RET folgezettel-org-roam RET
@end example

@section Manual Installation

@enumerate
@item
Clone the repository:
@example
git clone https://github.com/MooersLab/folgezettel-org-roam.git
@end example

@item
Add to your load path in @file{init.el}:
@lisp
(add-to-list 'load-path "/path/to/folgezettel-org-roam")
(require 'folgezettel-org-roam)
@end lisp

@item
Enable the mode:
@lisp
(folgezettel-org-roam-mode 1)
@end lisp
@end enumerate

@section Installing the Info Manual

To install the Info manual for access within Emacs:

@example
make info
sudo make install-info
@end example

Or manually:

@example
makeinfo folgezettel-org-roam.texi
sudo cp folgezettel-org-roam.info /usr/local/share/info/
sudo install-info /usr/local/share/info/folgezettel-org-roam.info \
    /usr/local/share/info/dir
@end example

Then access via @kbd{C-h i d m Folgezettel Org-Roam RET}.

@c ============================================================================
@node Quick Start
@chapter Quick Start

@section Basic Setup

Add to your @file{init.el}:

@lisp
(require 'folgezettel-org-roam)
(folgezettel-org-roam-mode 1)
@end lisp

@section Creating Your First Notes

@enumerate
@item
Create a root note with a folgezettel title:
@example
M-x org-roam-node-find RET
Title: 1 My First Topic
@end example

@item
Open the root note and create a child:
@example
M-x folgezettel-org-roam-insert-next-child RET
@end example

@item
The package suggests @code{1.1} as the first child.  Enter a title when prompted.

@item
Both notes now have bidirectional links:
@itemize @minus
@item
Child note has ``Parent Note'' section with link to @code{1}
@item
Parent note has ``Child Notes'' section with link to child
@end itemize
@end enumerate

@c ============================================================================
@node Folgezettel Addresses
@chapter Folgezettel Addresses

@cindex address format
@cindex hierarchy

@section Address Structure

Folgezettel addresses follow a strict hierarchical pattern:

@table @code
@item 1, 2, 3, ...
Root notes (single numbers)
@item 1.1, 1.2, 1.13, ...
First-level subtopics (number DOT number)
@item 1.2a, 1.2b, ..., 1.2z
Letter branches (lowercase letters)
@item 1.2aa, 1.2ab, ..., 1.2zz
Extended letter branches (after z comes aa)
@item 1.2a1, 1.2a2, ...
Numeric continuations of letter branches
@end table

@section Alternation Rules

The address system follows strict alternation:

@enumerate
@item
Root numbers can only have DOT-number children (@code{1} @result{} @code{1.1})
@item
DOT-number nodes can only have letter children (@code{1.1} @result{} @code{1.1a})
@item
Letter-ending nodes can only have number children (@code{1.1a} @result{} @code{1.1a1})
@item
The pattern continues alternating
@end enumerate

@section Parent-Child Relationships

@multitable @columnfractions .3 .3 .4
@headitem Child @tab Parent @tab Relationship
@item @code{1.2} @tab @code{1} @tab Remove .number
@item @code{1.2a} @tab @code{1.2} @tab Remove letters
@item @code{1.2aa} @tab @code{1.2} @tab Remove ALL letters
@item @code{1.2a3} @tab @code{1.2a} @tab Remove trailing number
@item @code{1.2a3b} @tab @code{1.2a3} @tab Remove trailing letters
@end multitable

@section Valid vs Invalid Addresses

@subsection Valid Examples
@itemize @bullet
@item @code{1} - Root note
@item @code{1.13} - Multi-digit subtopic
@item @code{1.2a} - Single letter branch
@item @code{1.2aa} - Extended letter (27th child)
@item @code{1.2a3c5d7} - Deep hierarchy
@end itemize

@subsection Invalid Examples
@itemize @bullet
@item @code{1.2.3} - Multiple periods not allowed
@item @code{1.2A} - Uppercase not allowed
@item @code{1.2a!} - Special characters not allowed
@item @code{a1} - Must start with number
@end itemize

@c ============================================================================
@node Usage
@chapter Usage

@section Automatic Link Creation

@cindex automatic linking
When @code{folgezettel-org-roam-mode} is enabled, creating a new note with
a folgezettel address automatically:

@enumerate
@item
Identifies the parent note based on the address
@item
Inserts a backlink under @samp{** Parent Note} in the new note
@item
Inserts a forward link under @samp{** Child Notes} in the parent
@end enumerate

@section Creating Child Notes

@findex folgezettel-org-roam-insert-next-child
The recommended way to create child notes:

@example
M-x folgezettel-org-roam-insert-next-child
@end example

This command:
@enumerate
@item
Reads the current note's folgezettel address
@item
Suggests the next available child address
@item
Prompts for a title
@item
Creates the note with proper bidirectional links
@end enumerate

@section Manual Link Addition

@findex folgezettel-org-roam-add-backlink-to-parent
For existing notes without links:

@example
M-x folgezettel-org-roam-add-backlink-to-parent
@end example

@section Cross-Reference Links

@cindex cross-references
When you insert a link to another org-roam note using @kbd{C-c C-l} or
@code{org-roam-node-insert}, a reciprocal link is automatically created
in the target note under @samp{** Cross References}.

This can be disabled:
@lisp
(setq folgezettel-org-roam-auto-crosslink nil)
@end lisp

@c ============================================================================
@node Customization
@chapter Customization

@findex customize-group
All customization options are in the @code{folgezettel-org-roam} group:

@example
M-x customize-group RET folgezettel-org-roam RET
@end example

@section Link Descriptions

@defopt folgezettel-org-roam-parent-link-description
Description text for parent links.  Default: @code{"Parent note"}.
@end defopt

@defopt folgezettel-org-roam-child-link-description
Description for child links.  If @code{nil} (default), uses the child's title.
@end defopt

@section Headings

@defopt folgezettel-org-roam-backlink-heading
Heading for parent links in child notes.  Default: @code{"Parent Note"}.
Set to @code{nil} to insert without a heading.
@end defopt

@defopt folgezettel-org-roam-forward-link-heading
Heading for child links in parent notes.  Default: @code{"Child Notes"}.
@end defopt

@defopt folgezettel-org-roam-crosslink-heading
Heading for cross-reference links.  Default: @code{"Cross References"}.
@end defopt

@section Behavior

@defopt folgezettel-org-roam-auto-crosslink
Enable automatic reciprocal links when inserting cross-references.
Default: @code{t}.
@end defopt

@defopt folgezettel-org-roam-sync-db-before-queries
Sync org-roam database before queries.  Default: @code{t}.
Recommended for reliability.
@end defopt

@section Example Configuration

@lisp
(use-package folgezettel-org-roam
  :after org-roam
  :config
  (setq folgezettel-org-roam-parent-link-description "â†‘ Parent"
        folgezettel-org-roam-backlink-heading "Parent Note"
        folgezettel-org-roam-forward-link-heading "Child Notes"
        folgezettel-org-roam-auto-crosslink t)
  (folgezettel-org-roam-mode 1))
@end lisp

@c ============================================================================
@node Commands
@chapter Commands

@section Interactive Commands

@deffn Command folgezettel-org-roam-mode
Toggle the minor mode.  When enabled, automatically creates bidirectional
links for new notes with folgezettel addresses.
@end deffn

@deffn Command folgezettel-org-roam-insert-next-child
Create a new child note of the current note.  Suggests the next available
address and prompts for a title.  Creates bidirectional links automatically.
@end deffn

@deffn Command folgezettel-org-roam-add-backlink-to-parent
Manually add bidirectional links between the current note and its parent.
Useful for existing notes or when automatic linking fails.
@end deffn

@deffn Command folgezettel-org-roam-report-validation-errors address
Interactively validate an address and display any errors.
@end deffn

@deffn Command folgezettel-org-roam-diagnose-address address
Diagnose issues finding a folgezettel address in the database.
Shows all nodes and their extracted addresses.
@end deffn

@deffn Command folgezettel-org-roam-check-duplicate-index address
Check if an address is already used.  Warns if duplicate found.
@end deffn

@section Suggested Key Bindings

@lisp
(with-eval-after-load 'org-roam
  (define-key org-roam-mode-map (kbd "C-c n c")
    #'folgezettel-org-roam-insert-next-child)
  (define-key org-roam-mode-map (kbd "C-c n p")
    #'folgezettel-org-roam-add-backlink-to-parent))
@end lisp

@c ============================================================================
@node Testing
@chapter Testing

@cindex testing
@cindex ERT

The package includes a comprehensive test suite with 64 tests.

@section Running Tests

@subsection From Command Line

@example
# Run all tests
make test

# Run unit tests only
make test-unit

# Run integration tests
make test-integration

# Run with verbose output
make test-verbose
@end example

@subsection From Within Emacs

@example
M-x ert RET t RET
@end example

Or load and run specific categories:

@lisp
(load-file "test-folgezettel-org-roam.el")
(ert-run-tests-interactively "^test-parse")
@end lisp

@section Test Categories

@multitable @columnfractions .3 .1 .6
@headitem Category @tab Count @tab Description
@item Parsing @tab 9 @tab Address parsing functions
@item Extraction @tab 5 @tab Title extraction
@item Letter sequences @tab 5 @tab Alphabet incrementing
@item Validation @tab 16 @tab Address validation
@item Suggestions @tab 8 @tab Child address suggestions
@item Link insertion @tab 6 @tab Link creation in files
@item Integration @tab 2 @tab Full workflow tests
@item Edge cases @tab 5 @tab Boundary conditions
@item Regression @tab 5 @tab Previously fixed bugs
@item Performance @tab 2 @tab Speed benchmarks
@end multitable

@section Test File Structure

The test file @file{test-folgezettel-org-roam.el} includes:

@itemize @bullet
@item
Mock infrastructure for org-roam nodes
@item
Temporary directory management
@item
Helper functions for test isolation
@item
Comprehensive assertions with clear failure messages
@end itemize

@c ============================================================================
@node Troubleshooting
@chapter Troubleshooting

@section Parent Note Not Found

@cindex troubleshooting

If the parent note is not found:

@enumerate
@item
Run @code{M-x folgezettel-org-roam-diagnose-address} with the parent address
@item
Verify the parent note exists with the correct folgezettel in its title
@item
Run @code{M-x org-roam-db-sync} to update the database
@end enumerate

@section Links Not Appearing in Backlinks Buffer

Ensure database sync is enabled:

@lisp
(setq folgezettel-org-roam-sync-db-before-queries t)
@end lisp

@section Invalid Address Errors

Use validation to check addresses:

@example
M-x folgezettel-org-roam-report-validation-errors RET 1.2a RET
@end example

Common issues:
@itemize @bullet
@item
Multiple periods (@code{1.2.3}) - only one allowed
@item
Uppercase letters (@code{1.2A}) - use lowercase only
@item
Special characters - only digits, lowercase letters, and one period
@end itemize

@section Mode Not Working

Verify the mode is enabled:

@lisp
(folgezettel-org-roam-mode 1)
@end lisp

Check that the hook is registered:

@lisp
(member 'folgezettel-org-roam--process-new-node
        org-roam-capture-new-node-hook)
@end lisp

@c ============================================================================
@node Index
@appendix Index

@section Concept Index
@printindex cp

@section Function Index
@printindex fn

@bye
